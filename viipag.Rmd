

# Conclusiones y Recomendaciones

```{r setup-pag3, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE, 
  warning = FALSE, 
  message = FALSE,
  fig.width = 10,
  fig.height = 6,
  dpi = 300
)

# Paquetes necesarios para el análisis
suppressPackageStartupMessages({
  library(tidyverse)    # Manipulación de datos y visualización
  library(GGally)       # Matrices de correlación y gráficos paired
  library(scales)       # Escalas para gráficos
  library(knitr)        # Tablas formateadas
  library(DT)           # Tablas interactivas
})

# Configuración del theme y paleta de colores
theme_set(theme_minimal(base_size = 12))
pal <- c("Math" = "#2B8CBE", "Portuguese" = "#E34A33")

# Carga de los datasets originales
mat <- read.delim("student-mat.csv", sep = ";")
por <- read.delim("student-por.csv", sep = ";")

# Estandarización de nombres de columnas
names(mat) <- tolower(gsub("\\.", "_", names(mat)))
names(por) <- tolower(gsub("\\.", "_", names(por)))

# Definición de tipos de variables
factor_vars_base  <- c("school","sex","address","famsize","pstatus","mjob","fjob","reason",
                       "guardian","schoolsup","famsup","paid","activities","nursery",
                       "higher","internet","romantic")

numeric_vars_base <- c("age","medu","fedu","traveltime","studytime","failures",
                       "famrel","freetime","goout","dalc","walc","health",
                       "absences","g1","g2","g3")

# Conversión de tipos de datos
mat[intersect(factor_vars_base,  names(mat))] <- 
  lapply(mat[intersect(factor_vars_base,  names(mat))], factor)
por[intersect(factor_vars_base,  names(por))] <- 
  lapply(por[intersect(factor_vars_base,  names(por))], factor)

mat[intersect(numeric_vars_base, names(mat))] <- 
  lapply(mat[intersect(numeric_vars_base, names(mat))], as.numeric)
por[intersect(numeric_vars_base, names(por))] <- 
  lapply(por[intersect(numeric_vars_base, names(por))], as.numeric)

# Eliminación de duplicados y variables no utilizadas
mat <- mat %>% distinct() %>% select(-any_of(c("famsize","nursery")))
por <- por %>% distinct() %>% select(-any_of(c("famsize","nursery")))

# Combinación de datasets con etiqueta de materia
mat$subject <- "Math"
por$subject <- "Portuguese" 
df_all <- bind_rows(mat, por) %>% relocate(subject)

# Actualización de listas de variables
factor_vars  <- intersect(factor_vars_base,  names(df_all))
numeric_vars <- intersect(numeric_vars_base, names(df_all))





# Resumen dimensional
cat("Dimensiones del dataset combinado:", dim(df_all)[1], "observaciones,", dim(df_all)[2], "variables\n")
cat("Matemáticas:", nrow(mat), "estudiantes\n")
cat("Portugués:", nrow(por), "estudiantes\n")

# Estructura de variables
cat("\n=== ESTRUCTURA DE VARIABLES ===\n")
cat("Variables categóricas (", length(factor_vars), "):", paste(factor_vars, collapse = ", "), "\n")
cat("Variables numéricas (", length(numeric_vars), "):", paste(numeric_vars, collapse = ", "), "\n")

# Creación de variable binaria (aprobado/reprobado)
df_bin <- df_all %>%
  mutate(
    status = factor(
      if_else(g3 >= 10, "Aprobado", "Reprobado"),
      levels = c("Reprobado", "Aprobado")
    )
  )

# Estadísticas de aprobación
pass_stats <- df_bin %>%
  group_by(subject) %>%
  summarise(
    total = n(),
    aprobados = sum(status == "Aprobado"),
    tasa_aprobacion = mean(status == "Aprobado") * 100,
    .groups = "drop"
  )

kable(pass_stats,
      caption = "Tasas de aprobación por materia",
      digits = 1,
      col.names = c("Materia", "Total", "Aprobados", "Tasa Aprobación (%)"))

cats_key <- intersect(c("sex","address","schoolsup","higher","internet"), names(df_all))

cat_stats <- purrr::map_dfr(cats_key, function(var){
  df_all %>%
    group_by(subject, !!sym(var)) %>%
    summarise(
      n = n(),
      mean_g3 = mean(g3),
      sd_g3 = sd(g3),
      .groups = "drop"
    ) %>%
    mutate(
      variable = var,
      category = as.character(!!sym(var))
    ) %>%
    # nos quedamos solo con las 6 columnas que queremos
    select(subject, variable, category, n, mean_g3, sd_g3)
})

knitr::kable(
  head(cat_stats, 10),
  caption = "Estadísticas de G3 por categorías (primeras 10 filas)",
  digits = 2,
  col.names = c("Materia", "Variable", "Categoría", "N", "Media G3", "SD G3")
)

nums_key <- intersect(c("g3","g2","g1","studytime","failures","absences","age"), names(df_all))
vars_panel <- unique(c(nums_key, intersect("sex", names(df_all))))
df_small <- df_all[, unique(c(vars_panel, "subject"))]

# Panel multivariado con GGally
p_mix <- ggpairs(
  df_small,
  mapping = ggplot2::aes(color = subject, alpha = 0.55),
  upper = list(
    continuous = wrap("cor", size = 3),    # Correlaciones en triángulo superior
    combo      = "box_no_facet",           # Boxplots para cat~num
    discrete   = "blank"                   # Espacio en blanco para cat~cat
  ),
  lower = list(
    continuous = wrap("points", alpha = .35, size = .6),  # Scatter plots
    combo      = "facethist",              # Histogramas por facetas
    discrete   = "count"                   # Conteos para cat~cat
  ),
  diag  = list(continuous = "densityDiag"), # Densidades en diagonal
  title = "Exploración compacta — Variables clave (coloreado por asignatura)"
) + theme(legend.position = "bottom")

print(p_mix)

g3_stats <- df_all %>% 
  group_by(subject) %>%
  summarise(
    n = n(),
    media = mean(g3),
    desv_std = sd(g3),
    mediana = median(g3),
    q1 = quantile(g3, .25),
    q3 = quantile(g3, .75),
    minimo = min(g3),
    maximo = max(g3),
    .groups = "drop"
  )

kable(g3_stats, 
      caption = "Estadísticas descriptivas de G3 por materia",
      digits = 2,
      col.names = c("Materia", "N", "Media", "Desv.Std", "Mediana", "Q1", "Q3", "Mín", "Máx"))


```

**Diferencias por Materia**
- **Portugués presenta mejor rendimiento general** que Matemáticas (media: `r round(g3_stats$media[g3_stats$subject == "Portuguese"], 2)` vs `r round(g3_stats$media[g3_stats$subject == "Math"], 2)`)
- **Matemáticas muestra mayor variabilidad** en las calificaciones, sugiriendo polarización en el rendimiento
- Las **correlaciones entre predictores y G3 son consistentes** entre materias, indicando factores comunes de éxito

**Conclusión sobre Missingness:** 
Los datos están completos, sin valores perdidos, lo que indica una excelente calidad en la recolección de información. Esto elimina la necesidad de técnicas de imputación y permite proceder directamente con el análisis.


**Predictores Clave del Rendimiento**
1. **Rendimiento previo (G1, G2):** Factor más fuerte (r > 0.8)
2. **Historial de reprobaciones:** Predictor negativo crítico
3. **Aspiraciones educativas:** Diferenciador importante del éxito
4. **Acceso a recursos tecnológicos:** Ventaja competitiva
5. **Tiempo de estudio:** Correlación positiva moderada pero consistente

**Patrones de Riesgo Académico**
- Estudiantes con **múltiples reprobaciones** tienen probabilidades extremadamente bajas de éxito
- La **combinación de bajo apoyo familiar y escolar** crea vulnerabilidad académica
- **Altas ausencias** se asocian sistemáticamente con bajo rendimiento

---

## Referencias y Metodología

**Dataset:** P. Cortez and A. Silva. Using Data Mining to Predict Secondary School Student Performance. In A. Brito and J. Teixeira Eds., Proceedings of 5th FUture BUsiness TEChnology Conference (FUBUTEC 2008) pp. 5-12, Porto, Portugal, April, 2008, EUROSIS, ISBN 978-9077381-39-7.

**Herramientas utilizadas:**
- R `r R.version.string`
- Tidyverse `r packageVersion("tidyverse")`
- GGally `r packageVersion("GGally")`


---
